<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Colins Example</title>

    <script src="../JavaScript/jquery-1.8.2.js" type="text/javascript"></script>
    <script src="../JavaScript/jquery-ui-1.9.1.custom.js" type="text/javascript"></script>
    <script src="../JavaScript/knockout.js" type="text/javascript"></script>
    <script src="../JavaScript/knockout.mapping.js" type="text/javascript"></script>
    <script src="../JavaScript/application.js" type="text/javascript"></script>
    <script src="../JavaScript/bootstrap.js" type="text/javascript"></script>
    <link href="../css/jquery-ui-1.9.1.css" type="text/css" rel="stylesheet" />
    <link href="../css/bootstrap.css" type="text/css" rel="stylesheet" />

</head>

<body>
    <div class="container">
        <div class="row" id="app">
        </div>
    </div>

    <script type="text/html" id="runs-template">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Run Date</th>
                    <th>Run Name</th>
                    <th></th>
                </tr>
            </thead>
            <tbody data-bind="foreach: runs">
                <tr>
                    <td data-bind="text: RunTime"></td>
                    <td data-bind="text: Name"></td>
                    <td>
                        <button data-bind="click: Expand" class="btn">View</button></td>
                </tr>
            </tbody>
        </table>
    </script>
    
    <script type="text/html" id="run-detail">    
        <div id="myModal" class="modal hide fade">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h3 data-bind="text:Name">Modal header</h3>
            </div>
            <div class="modal-body">
                <p>One fine body…</p>
            </div>
            <div class="modal-footer">
                <a href="#" class="btn" data-dismiss="modal">Close</a>
            </div>
        </div>
    </script>

    <script type="text/javascript">
        $(document).ready(function () {
            //elements
            var $runsEl = $('<span class="span12" data-bind="template: { name: \'runs-template\' }"></span>');
            var $runDetail = $('<span data-bind="template: { name: \'run-detail\' }"></span>');
           
            
            //data
            function expand(run) {
                var f = function() {
                    //stun the next thing to do
                    ko.applyBindings(run, $runDetail.get(0));
                    $('#myModal').modal('show');
                };
                return f;
            }

            function mapExpand(run) {
                run.Expand = expand(run);
                return run;
            }
            
            var run1 = mapExpand({ RunTime: '2013-03-21', Name: 'Run 1' });
            var run2 = mapExpand({ RunTime: '2013-03-27', Name: 'Run 2' });
             
            ko.applyBindings(
                {
                    runs: [run1,run2]
                }, $runsEl.get(0));
            
            $('#app').append($runsEl);
            $('#app').append($runDetail);
        });
    </script>
</body>
</html>
